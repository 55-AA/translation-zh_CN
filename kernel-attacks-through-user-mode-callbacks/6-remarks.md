# 6. 评论

正如我们已经在本文中展示的那样，用户模式回调函数似乎在 Win32k
子系统中造成了许多问题并且引入了许多漏洞。一部分是因为 Win32k，
或者更确切的说，窗口管理器，的设计使用了全局锁机制（用户临界区）
来实现线程安全。尽管以发现一个解决一个的方式处理这些漏洞作为短期的解决方案是够用的，
但是为了更好的支持多核架构与提供更好的窗口管理性能，Win32k
在将来的某个时候会需要一个跨越性的飞跃。在现在的设计里，
处于同一会话的两个线程不能够同时处理它们的消息队列，
哪怕它们属于两个独立的应用程序并且在不同的桌面。理想地，
Win32k 应该遵循更加具有一致性的 NT 执行体的设计，
并且在每个对象或者每个结构地基础上实行互斥。

在缓和 Win32k 与更为一般的 Windwos 内核漏洞利用上，
重要的一步就是，摆脱在用户模式与内核模式之间的共享内存区段。
以前，这些区段被认为是优化，因为 Win32 子系统就不需要借助系统调用，
因而避免了相关联的额外消耗。自从这种设计的决定作出，
系统调用现在不再使用缓慢的基于中断的方式，因而性能的提升也可能微乎其微。
尽管共享区段在有些情况下可能会更好，共享的信息也应该控制到最少。
现在，Win32k 子系统提供给攻击者大量的内核地址空间信息，
而且还打开了额外地的击向量，这在最近的一个 CSRSS 漏洞的利用中可以看到
（参见参考文献 4）。这是因为在这个子系统里，内存在进程间是共享的，
无论它们的特权，攻击者有能力从没有特权的进程操纵有特权进程的地址空间。
